
# A very simple website to let powder operators run cocoa cake corrections calculator

from flask import Flask, request

from cakecorrections import do_calculation

app = Flask(__name__)
app.config["DEBUG"] = True

@app.route("/", methods=["GET", "POST"])
def adder_page():
    errors=""
    if request.method =="POST":
        badspec= None
        badvolume= None
        goodspec=None
        goodvolume=None
        try:
            badspec=float(request.form["badspec"])
        except:
            errors+="<p>{!r} is not a number.</p>\n".format(request.form["badspec"])
        try:
            badvolume=float(request.form["badvolume"])
        except:
            errors+="<p>{!r} is not a number.</p>\n".format(request.form["badvolume"])
        try:
            goodspec=float(request.form["goodspec"])
        except:
            errors+="<p>{!r} is not a number.</p>\n".format(request.form["goodspec"])
        try:
            goodvolume=float(request.form["goodvolume"])
        except:
            errors+="<p>{!r} is not a number.</p>\n".format(request.form["goodvolume"])
        if badspec is not None and badvolume is not None and goodspec is not None and goodvolume is not None:
            result = do_calculation(badspec,badvolume,goodspec,goodvolume)
            return '''
            <html>
                <body>
                    <p>The result is {result}</p>
                    <p><a href="/">Click here to calculate again</a>
                </body>
            </html>
        '''.format(result=result)

    return '''
        <html>
            <body>
                {errors}
                <p>ENTER SPECS OF BAD CAKE:</p>
                <form method="post" action=".">
                    <label for="badspec">Spec Value:</label>
                    <p><input name="badspec" /></p>
                    <label for="badvolume">Volume:</label>
                    <p><input name="badvolume" /></p>
                <p>ENTER SPECS OF GOOD CAKE YOU WANT TO ADD:</p>
                    <label for="goodspec">Spec Value:</label>
                    <p><input name="goodspec" /></p>
                    <label for="goodvolume">Volume:</label>
                    <p><input name="goodvolume" /></p>
                    <p><input type="submit" value="CALCULATE"/></p>
                </form>
            </body>
        </html>
    '''.format(errors=errors)
